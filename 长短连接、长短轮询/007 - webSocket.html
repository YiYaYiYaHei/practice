<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>webSocket</title>
</head>
<body>
  <div>

  </div>
  <a href="https://blog.csdn.net/sinat_36422236/article/details/85051547" target="_blank" style="color: blue">websocket深入浅出</a>
  <a href="http://caibaojian.com/http-connection-and-websocket.html" target="_blank" style="color: blue">长连接、短连接、长轮询和WebSocket</a>

  <p>浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
  <p>
    WebSocket 是独立的、创建在 TCP 上的协议。

    Websocket 通过 HTTP/1.1 协议的101状态码进行握手。

    为了创建Websocket连接，需要通过浏览器发出请求，之后服务器进行回应，这个过程通常称为“握手”（handshaking）。</p>

  <h5>WebSocket优点</h5>
  <ul>
    <li>较少的控制开销。在连接创建后，服务器和客户端之间交换数据时，用于协议控制的数据包头部相对较小。在不包含扩展的情况下，对于服务器到客户端的内容，此头部大小只有2至10字节（和数据包长度有关）；对于客户端到服务器的内容，此头部还需要加上额外的4字节的掩码。相对于HTTP请求每次都要携带完整的头部，此项开销显著减少了。</li>
    <li>更强的实时性。由于协议是全双工的，所以服务器可以随时主动给客户端下发数据。相对于HTTP请求需要等待客户端发起请求服务端才能响应，延迟明显更少；即使是和Comet等类似的长轮询比较，其也能在短时间内更多次地传递数据。</li>
    <li>保持连接状态。于HTTP不同的是，Websocket需要先创建连接，这就使得其成为一种有状态的协议，之后通信时可以省略部分状态信息。而HTTP请求可能需要在每个请求都携带状态信息（如身份认证等）。</li>
    <li>更好的二进制支持。Websocket定义了二进制帧，相对HTTP，可以更轻松地处理二进制内容。</li>
    <li>可以支持扩展。Websocket定义了扩展，用户可以扩展协议、实现部分自定义的子协议。如部分浏览器支持压缩等。</li>
    <li>更好的压缩效果。相对于HTTP压缩，Websocket在适当的扩展支持下，可以沿用之前内容的上下文，在传递类似的数据时，可以显著地提高压缩率。</li>
  </ul>
  <script>
    window.onload = () => {
      const webSocket = new WebSocket('ws://localhost:13666/test1/1');
      webSocket.onopen = () => {
        alert('open:连接成功');
        webSocket.send('hello world');
      };
      webSocket.onmessage = (e) => {
        console.log('后端推送', e);
      };
      webSocket.onclose = (e) => {
        console.log('关闭连接', e);
      };
      webSocket.onerror = (e) => {
        console.log('连接失败', e);
      };
    }
  </script>
</body>
</html>
